# 현재 작업 상태 (Live Document)

> **마지막 업데이트**: 2026-01-10 08:45 KST
> **업데이트 작업자**: Claude Opus 4.5
> **현재 버전**: v4.0.0

---

## 프로젝트 상태 요약

```
┌─────────────────────────────────────────────────────────────┐
│                    현재 프로젝트 상태                          │
├─────────────────────────────────────────────────────────────┤
│  버전: v4.0.0 ⭐ NEW                                         │
│  상태: 🟢 정상 운영 중                                        │
│  서버: 141.164.55.245 (한국 서울)                            │
│  핵심 업데이트: EnhancedUpsetDetector (이변 감지 강화)         │
└─────────────────────────────────────────────────────────────┘
```

---

## v4.0.0 핵심 변경 (2026-01-10) ⭐ NEW

### 이변 감지 강화 시스템

**사용자 요청 반영:**
> "언더독, 이변이 있는 경기를 찾는데 중점을 둬야한다고 생각해.
> 14경기를 다 맞춰야하고 추가적인 복수배팅이 가능하니
> 언더독 이변이 있을 경기를 찾는걸 더 신경써 줬으면해"

### 구현 완료된 기능

| 모듈 | 파일 | 상태 | 설명 |
|------|------|------|------|
| EnhancedUpsetDetector | `src/services/data/enhanced_upset_detector.py` | ✅ | 종합 이변 감지 (800+ 라인) |
| FormCollector | `src/services/data/form_collector.py` | ✅ | 최근 폼 수집 (855 라인) |
| H2HCollector | `src/services/data/h2h_collector.py` | ✅ | 상대전적 수집 (679 라인) |
| TeamStatsCollector | `src/services/data/team_stats_collector.py` | ✅ | 팀 통계 수집 (787 라인) |
| InjuriesCollector | `src/services/data/injuries_collector.py` | ✅ | 부상자 정보 수집 |
| OddsCollector | `src/services/data/odds_collector.py` | ✅ | 배당률 변동 수집 |
| MatchEnricher | `src/services/data/match_enricher.py` | ✅ | 데이터 통합 매니저 |
| AI 프롬프트 개선 | `src/services/ai/base_analyzer.py` | ✅ | 이변 체크리스트 추가 |
| MatchContext 확장 | `src/services/ai/models.py` | ✅ | 실시간 데이터 필드 추가 |
| auto_notifier 통합 | `auto_sports_notifier.py` | ✅ | _select_multi_games 개선 |

### 이변 신호 4가지 카테고리

```
1. 확률 신호: 애매한 확률 분포, 낮은 신뢰도, AI 불일치
2. 폼 신호: 강팀 연패, 약팀 연승, 홈/원정 역전 ⭐ NEW
3. 상대전적 신호: H2H vs 배당 역전, 박빙 전적 ⭐ NEW
4. 상황 신호: 핵심 선수 부상, 강등권 싸움, 더비 ⭐ NEW
```

---

## 완료된 작업 (v4.0.0까지)

| 버전 | 작업 | 완료일 | 상태 |
|------|------|--------|------|
| **v4.0.0** | **EnhancedUpsetDetector** | **2026-01-10** | **✅** |
| **v4.0.0** | **실시간 데이터 수집 모듈** | **2026-01-10** | **✅** |
| **v4.0.0** | **AI 프롬프트 이변 감지 강화** | **2026-01-10** | **✅** |
| **v4.0.0** | **MatchContext 확장** | **2026-01-10** | **✅** |
| **v4.0.0** | **auto_notifier 통합** | **2026-01-10** | **✅** |
| v3.3.0 | 젠토토 크롤러 도입 | 2026-01-10 | ✅ |
| v3.3.0 | 3단계 데이터 소스 체계 | 2026-01-10 | ✅ |
| v3.3.0 | CLAUDE.md 완벽 정리 | 2026-01-10 | ✅ |
| v3.2.1 | 한국 서버 마이그레이션 | 2026-01-05 | ✅ |
| v3.1.0 | 적중률 추적 시스템 | 2025-12-25 | ✅ |
| v3.0.0 | 베트맨 크롤러 | 2025-12-25 | ✅ |

---

## 진행률 요약 (v4.0.0 실시간 데이터 연동)

| Phase | 작업 | 상태 | 진행률 |
|-------|------|------|--------|
| 1.1 | 팀 통계 수집 모듈 | ✅ 완료 | 100% |
| 1.2 | 최근 폼 수집 모듈 | ✅ 완료 | 100% |
| 1.3 | 상대 전적 수집 모듈 | ✅ 완료 | 100% |
| 1.4 | 부상자 정보 수집 모듈 | ✅ 완료 | 100% |
| 1.5 | 배당률 수집 모듈 | ✅ 완료 | 100% |
| 2.1 | 데이터 통합 서비스 | ✅ 완료 | 100% |
| 2.2 | MatchContext 확장 | ✅ 완료 | 100% |
| 3.1 | AI 프롬프트 개선 | ✅ 완료 | 100% |
| 4.1 | 팀명 매핑 DB | ✅ 완료 | 100% |
| 5.1 | 캐싱 전략 | ✅ 완료 | 100% |
| 5.2 | Rate Limiting | ✅ 완료 | 100% |
| 6.1 | 통합 및 테스트 | ✅ 완료 | 100% |

**전체 진행률**: 100% (12/12 phases) ✅

---

## 향후 작업 (v4.1.0)

### 실시간 API 연동

현재 데이터 수집 모듈은 **구조만 구현**되어 있으며, 실제 API 연동이 필요합니다:

| 작업 | 우선순위 | 설명 |
|------|----------|------|
| API-Football 연동 | P0 | 팀 통계, 폼, 상대전적 API 연동 |
| 부상자 API 연동 | P1 | TransferMarkt 또는 대안 |
| Gemini API 키 갱신 | P1 | 현재 403 오류 |
| 프로덕션 배포 | P0 | v4.0.0 Git push 필요 |

---

## 테스트 결과 (v4.0.0)

```bash
# 테스트 명령어
python3 auto_sports_notifier.py --soccer --test

# 결과 (2026-01-10 08:28)
✅ 젠토토 크롤러: 3회차 14경기 수집
✅ AI 앙상블: 4개 모델 정상 (Gemini 제외)
✅ 이변 감지: 복수 베팅 4경기 선정
   - 04번: 브레멘/호펜하임 (score=65 🔴HIGH)
   - 05번: 마인츠05/무승부 (score=52 🔴HIGH)
   - 11번: US레체/무승부 (score=48 🟡MED)
   - 07번: 쾰른/하이덴하 (score=35 🟡MED)
✅ 예측 저장: 정상
```

---

## 알려진 이슈

| 이슈 | 심각도 | 상태 | 비고 |
|------|--------|------|------|
| Gemini API 403 오류 | 낮음 | 🔴 미해결 | API 키 갱신 필요 |
| Kimi API 간헐적 429 | 낮음 | 🟡 모니터링 | Rate limit, 재시도로 해결됨 |
| 실시간 API 미연동 | 중간 | 🟡 계획됨 | v4.1.0에서 연동 예정 |

---

## 서버 상태 확인 명령어

```bash
# 컨테이너 상태
ssh root@141.164.55.245 "docker ps"

# 최근 로그
ssh root@141.164.55.245 "docker logs sports_analysis --tail=30"

# Git 커밋
ssh root@141.164.55.245 "cd /opt/sports-analysis && git log --oneline -3"
```

---

## 업데이트 히스토리

| 날짜 | 작업자 | 내용 |
|------|--------|------|
| 2026-01-10 08:45 | Claude Opus 4.5 | v4.0.0 완료, EnhancedUpsetDetector 통합 |
| 2026-01-10 05:15 | Claude Opus 4.5 | 최초 작성, 스킬 파일 구조 생성 |

---

**이 파일은 각 작업자가 작업 완료 시 업데이트해야 합니다!**
